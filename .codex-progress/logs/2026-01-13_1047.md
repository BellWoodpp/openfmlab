# 2026-01-13_1047 — Creem subscription + membership UX fixes, locale cookie, custom TTS title + DB migration

## What changed

- Creem / membership:
  - Improved webhook verification and subscription sync/backfill so membership state doesn’t rely on “success-page navigation”.
  - Membership “Upgrade Plan” flow updated to behave like Pricing (actionable upgrade vs. just navigating to Pricing).
  - Pricing “Current plan” button is now disabled/grey (Free-style) to prevent accidental clicks.
- Account/admin layout:
  - Footer hidden on `profile`, `membership`, `orders`, `admin/blogs` (and related panels).
- UI loading polish:
  - Token balance, avatar badge, and membership crown/leaf no longer flash incorrect placeholders; show a spinner while loading.
- Orders:
  - Added a red “Delete” button to soft-hide orders (`metadata.hidden=true`) so lists don’t grow forever.
- Branding / icons:
  - Use `public/photo/text-to-speech.ico` as the main favicon, `text-to-speech` as Apple icon, and swap RTVox header images for dark/light (with `alt="RTVox"`).
  - Removed “RTVox” text from header/footer.
- Locale persistence:
  - Persist language selection via `rtvox_locale` cookie; middleware redirects `/path` → `/{locale}/path` on return visits.
- Podcast MVP:
  - “Custom audio name” toggle + input added near **Upload File** and near **Share** (multi-language). The title is saved and used for download filenames.
  - DB: added `tts_generations.title` (drizzle migration `drizzle/0006_tts_generations_title.sql` + schema update). Column exists in DB.

## Notes / tradeoffs

- `drizzle-kit push` may hang when using a pooled URL; `drizzle.config.ts` now prefers `DATABASE_URL_UNPOOLED`.
- APIs are defensive: if the `title` column is missing (older DB), they fall back gracefully.

## Next steps

- Run a Creem end-to-end test (monthly→yearly upgrade, cancel) and confirm webhook events update membership correctly.
- Decide whether theme (dark/light) should also persist (cookie or localStorage) and implement if needed.

## Verification

- `npm run lint`
- `npx tsc --noEmit`

